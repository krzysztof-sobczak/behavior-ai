GET /logstash-2015.06.03/_search
{
  "query": {
    "match_all": {}
  },
  "aggs": {
    "profit": {
      "scripted_metric": {
        "init_script": "_agg['transactions'] = []",
        "map_script": "if (doc['path_category.raw'].value == \"INBOX\") { _agg.transactions.add(doc['clientip.raw'].value) }",
        "combine_script": "return _agg",
        "reduce_script": "ips = []; for (a in _aggs) { for (t in a.transactions) { ips.add(t) } }; return ips"
      }
    }
  }
}